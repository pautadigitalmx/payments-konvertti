'use strict';

var types = require('../types.js');
var refreshToken = require('./refresh-token.js');

// 5 minutes
const WITHIN_MILLISECONDS_OF_EXPIRY = 5 * 60 * 1000;
async function ensureOfflineTokenIsNotExpired(session, params, shop) {
    const { config } = params;
    if (config.future?.expiringOfflineAccessTokens &&
        session.isExpired(WITHIN_MILLISECONDS_OF_EXPIRY) &&
        config.distribution !== types.AppDistribution.ShopifyAdmin &&
        session.refreshToken) {
        const offlineSession = await refreshToken.default(params, shop, session.refreshToken);
        await config.sessionStorage.storeSession(offlineSession);
        return offlineSession;
    }
    return session;
}

exports.WITHIN_MILLISECONDS_OF_EXPIRY = WITHIN_MILLISECONDS_OF_EXPIRY;
exports.ensureOfflineTokenIsNotExpired = ensureOfflineTokenIsNotExpired;
//# sourceMappingURL=ensure-offline-token-is-not-expired.js.map
