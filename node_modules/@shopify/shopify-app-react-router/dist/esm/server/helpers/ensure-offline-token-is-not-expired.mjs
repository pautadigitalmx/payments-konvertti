import { AppDistribution } from '../types.mjs';
import refreshToken from './refresh-token.mjs';

// 5 minutes
const WITHIN_MILLISECONDS_OF_EXPIRY = 5 * 60 * 1000;
async function ensureOfflineTokenIsNotExpired(session, params, shop) {
    const { config } = params;
    if (config.future?.expiringOfflineAccessTokens &&
        session.isExpired(WITHIN_MILLISECONDS_OF_EXPIRY) &&
        config.distribution !== AppDistribution.ShopifyAdmin &&
        session.refreshToken) {
        const offlineSession = await refreshToken(params, shop, session.refreshToken);
        await config.sessionStorage.storeSession(offlineSession);
        return offlineSession;
    }
    return session;
}

export { WITHIN_MILLISECONDS_OF_EXPIRY, ensureOfflineTokenIsNotExpired };
//# sourceMappingURL=ensure-offline-token-is-not-expired.mjs.map
